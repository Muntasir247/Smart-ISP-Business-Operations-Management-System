<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <title>Smart ISP - Billing</title>
    <style>
      .sidebar.collapsed {
  margin-left: -250px;
}

      /* Sidebar submenu hidden by default */
      .sidebar .submenu {
        display: none;
        padding-left: 20px;
      }

      /* Show submenu when parent has 'active' */
      .sidebar .has-submenu.active > .submenu {
        display: block;
      }

      /* Highlight active menu */
      .sidebar a.active {
        background-color: #1f2937;
        color: #fff;
      }

      /* Rotate caret for active submenu */
      .sidebar .has-submenu > a.active i.fa-caret-right {
        transform: rotate(90deg);
        transition: transform 0.3s;
      }

      /* Simple table styling */
      .client-table {
        width: 100%;
        border-collapse: collapse;
      }

      .client-table th,
      .client-table td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
      }

      .btn {
        padding: 5px 10px;
        border: none;
        color: #fff;
        cursor: pointer;
        font-size: 13px;
      }

      .btn-navy {
        background-color: #1e3a8a;
      }

      .btn-default {
        background-color: #6b7280;
        cursor: not-allowed;
      }

      .btn-green {
        background-color: #16a34a;
      }

      /* Modal styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
      }

      .modal-content {
        background-color: #fff;
        margin: 10% auto;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        position: relative;
      }

      .close {
        position: absolute;
        right: 10px;
        top: 10px;
        font-size: 20px;
        cursor: pointer;
      }

      .modal h2 {
        margin-top: 0;
      }

      .modal button {
        margin-top: 10px;
      }

      /* ===== NEW BILLING HEADER UI ===== */
      .billing-hero {
        background: linear-gradient(90deg, #091c45);
        padding: 25px;
        border-radius: 10px;
        color: white;
        text-align: center;
        margin-bottom: 20px;
      }

      .billing-hero h1 {
        margin: 0;
        font-size: 26px;
        letter-spacing: 1px;
      }

      .billing-summary {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
        flex-wrap: wrap;
      }

      .summary-card {
        flex: 1;
        min-width: 280px;
        background: #fff;
        border-radius: 10px;
        padding: 18px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      }

      .summary-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .upgrade-btn {
        background: #051b4b;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
      }

      .payment-box {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 10px;
      }

      .payment-box i {
        font-size: 26px;
        color: #f59e0b;
      }

      .change-btn {
        background: #e5e7eb;
        border: none;
        padding: 5px 10px;
        border-radius: 6px;
        cursor: pointer;
      }

      .usage-bar {
        height: 8px;
        background: #e5e7eb;
        border-radius: 10px;
        margin: 10px 0;
        overflow: hidden;
      }

      .usage-fill {
        width: 90%;
        height: 100%;
        background: #0aa741;
      }
      .analytics {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.analytic-card {
  flex: 1;
  min-width: 200px;
  background: #ffffff;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  text-align: center;
}

.analytic-card h3 {
  margin: 0;
  font-size: 14px;
  color: #6b7280;
}

.analytic-card p {
  font-size: 22px;
  font-weight: bold;
  margin-top: 5px;
  color: #1e3a8a;
}

    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
  <div class="brand">
    <i class="fa-solid fa-circle-nodes"></i> Smart ISP
  </div>
  <ul class="menu">
    <!-- Dashboard -->
    <li>
      <a href="index.html"><i class="fa-solid fa-gauge"></i> Dashboard</a>
    </li>

    <!-- Billing (no submenus) -->
   
    <!-- Configuration (will have subpages later) -->
    <li class="has-submenu">
      <a href="#"><i class="fa-solid fa-cogs"></i> Configuration
        <i class="fa-solid fa-caret-right" style="float:right;font-size:10px;margin-top:5px"></i>
      </a>
      <ul class="submenu">
        <li><a href="dropdown1.html"><i class="fa-regular fa-circle"></i> Dropdown 1</a></li>
      </ul>
    </li>

    <!-- Client with submenus -->
    <li class="has-submenu">
      <a href="#"><i class="fa-solid fa-user"></i> Client
        <i class="fa-solid fa-caret-right" style="float:right;font-size:10px;margin-top:5px"></i>
      </a>
      <ul class="submenu">
        <li><a href="dropdown1.html"><i class="fa-regular fa-circle"></i> New Request</a></li>
        <li><a href="dropdown1.html"><i class="fa-regular fa-circle"></i> Add New</a></li>
        <li><a href="client_list.html"><i class="fa-regular fa-circle"></i> Client List</a></li>
        <li><a href="dropdown1.html"><i class="fa-regular fa-circle"></i> Left Client</a></li>
        <li><a href="dropdown1.html"><i class="fa-regular fa-circle"></i> Scheduler</a></li>
        <li><a href="dropdown1.html"><i class="fa-regular fa-circle"></i> Change Request</a></li>
        <li><a href="dropdown1.html"><i class="fa-regular fa-circle"></i> Portal Manage</a></li>
      </ul>
    </li>

    <!-- Other main items without submenus -->
     <!-- Billing (no submenus) -->
    <li>
      <a href="billing.html"><i class="fa-solid fa-file-invoice"></i> Billing</a>
    </li>

    <li><a href="#"><i class="fa-solid fa-server"></i> Mikrotik Server</a></li>
    <li><a href="#"><i class="fa-solid fa-users-gear"></i> HR & Payroll</a></li>
    <li><a href="#"><i class="fa-solid fa-door-open"></i> Leave Management</a></li>
    <li><a href="events_holidays.html"><i class="fa-solid fa-calendar-days"></i> Events & Holidays</a></li>
    <li><a href="#"><i class="fa-solid fa-headset"></i> Support & Ticketing</a></li>
    <li><a href="#"><i class="fa-solid fa-list-check"></i> Task Management</a></li>
    <li><a href="#"><i class="fa-solid fa-cart-shopping"></i> Bandwidth Buy</a></li>
    <li><a href="#"><i class="fa-solid fa-basket-shopping"></i> Purchase</a></li>
    <li><a href="#"><i class="fa-solid fa-boxes-stacked"></i> Inventory</a></li>
    <li><a href="#"><i class="fa-solid fa-laptop-medical"></i> Assets</a></li>
    <li><a href="#"><i class="fa-solid fa-money-bill-trend-up"></i> Income</a></li>
  </ul>
</aside>


    <div class="main-content">
      <header>
        <div class="header-left">
          <div class="sidebar-toggle"><i class="fa-solid fa-bars"></i></div>
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search Customer or ID" />
            <i class="fa-solid fa-magnifying-glass"></i>
          </div>
        </div>
        
        <div class="header-right">
          <div class="monitor"><i class="fa-solid fa-desktop"></i> Online Client Monitoring</div>
          <div class="releases"><i class="fa-solid fa-wrench"></i> Releases <span class="badge">0</span></div>
          <div class="notifications"><i class="fa-solid fa-bell"></i> <span class="badge">0</span></div>
          <div class="profile"><i class="fa-solid fa-user-circle"></i></div>
        </div>
      </header>

      <div class="page-content">
        

        <!-- NEW TOP BILLING UI -->
        <div class="billing-hero">
          <h1>Billing and Invoicing Screen</h1>
        </div>

        <div class="billing-summary">
          <div class="summary-card">
            <div class="summary-head">
              <h3>Current Plan Summary</h3>
              <button class="upgrade-btn">Upgrade</button>
            </div>
            <p><strong>Plan:</strong> Growth Plan</p>
            <p><strong>Billing Cycle:</strong> Monthly</p>
            <p><strong>Cost:</strong> à§³5698</p>
            <div class="usage-bar"><div class="usage-fill"></div></div>
            <small>4850 out of 5k monthly active users</small>
          </div>

          <div class="summary-card">
            <h3>Analytic Dashboard</h3>
            <div class="payment-box">
             
              <div class="analytics">
          <div class="analytic-card">
              <h3>Total Collected</h3>
         <p id="totalCollected">à§³0</p>
           </div>

          <div class="analytic-card">
              <h3>Total Due</h3>
          <p id="totalDue">à§³0</p>
        </div>

       <div class="analytic-card">
        <h3>Unpaid Clients</h3>
       <p id="unpaidCount">0</p>
           </div>
                 </div>

            </div>
          </div>
        </div>

        <h1>Monthly Billing</h1>
        <div class="card">
          <div class="data-table-container">
            <button onclick="exportToExcel()" class="btn btn-green" style="margin-bottom:10px;">
         <i class="fa-solid fa-file-excel"></i> Export Excel Report
         </button>

            <table id="billingTable" class="client-table">
              <thead>
                <tr>
                  <th>Customer ID</th>
                  <th>Name</th>
                  <th>Address</th>
                  <th>Month</th>
                  <th>Bill Amount</th>
                  <th>Paid</th>
                  <th>Payment Method</th>
                  <th>Package</th>
                  <th>Action</th>
                 
                </tr>
              </thead>
              <tbody id="billingBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for Invoice -->
    <div id="invoiceModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Invoice</h2>
        <div id="invoiceContent"></div>
        <button onclick="printInvoice()" class="btn btn-navy"><i class="fa-solid fa-print"></i> Print</button>
        <button onclick="downloadInvoice()" class="btn btn-green"><i class="fa-solid fa-download"></i> Download PDF</button>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
   
    function updateAnalytics() {
  let totalCollected = 0;
  let totalDue = 0;
  let unpaid = 0;

  billingData.forEach(c => {
    if (c.paid) totalCollected += c.amount;
    else {
      totalDue += c.amount;
      unpaid++;
    }
  });

  document.getElementById('totalCollected').innerText = `à§³${totalCollected.toLocaleString()}`;
  document.getElementById('totalDue').innerText = `à§³${totalDue.toLocaleString()}`;
  document.getElementById('unpaidCount').innerText = unpaid;
}

      function exportToExcel() {

  const dataForExcel = billingData.map(c => ({
    "Customer ID": c.id,
    "Name": c.name,
    "Address": c.address,
    "Month": c.month,
    "Bill Amount (BDT)": c.amount,
    "Status": c.paid ? "Paid" : "Unpaid",
    "Payment Method": c.method,
    "Package": c.package
  }));

  const worksheet = XLSX.utils.json_to_sheet(dataForExcel);
  const workbook = XLSX.utils.book_new();

  XLSX.utils.book_append_sheet(workbook, worksheet, "Billing Report");

  XLSX.writeFile(workbook, "Smart_ISP_Billing_Report.xlsx");
}

      const { jsPDF } = window.jspdf;

      const sidebarToggle = document.querySelector('.sidebar-toggle');
      const sidebar = document.querySelector('.sidebar');
      sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('active');
      });

      document.querySelectorAll('.sidebar .has-submenu > a').forEach(menu => {
        menu.addEventListener('click', function(e) {
          e.preventDefault();
          const parent = this.parentElement;
          parent.classList.toggle('active');
        });
      });

      const billingData = [
        {id: 'C1001', name: 'John Doe', address: '123 Main St', month: 'January', amount: 500, paid: true, method: 'Bkash',package:'Star'},
        {id: 'C1002', name: 'Jane Smith', address: '456 Elm St', month: 'January', amount: 450, paid: false, method: 'Nagad',package:'Basic'},
        {id: 'C1003', name: 'Robert Brown', address: '789 Oak St', month: 'January', amount: 600, paid: true, method: 'Cash',package:'Premium'},
        {id: 'C1004', name: 'Emily Davis', address: '321 Pine St', month: 'January', amount: 550, paid: false, method: 'Bkash',package:'Silver'},
      ];

      const billingBody = document.getElementById('billingBody');

      function renderBillingTable(data) {
        billingBody.innerHTML = '';
        data.forEach(c => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${c.id}</td>
            <td>${c.name}</td>
            <td>${c.address}</td>
            <td>${c.month}</td>
            <td>à§³${c.amount.toLocaleString()}</td>
            <td>${c.paid ? '<span style="color:green">Paid</span>' : '<span style="color:red">Unpaid</span>'}</td>
            <td>${c.method}</td>
            <td>${c.package}</td>
            <td>
              <button class="btn btn-navy" onclick="openInvoiceModal('${c.id}')">
                <i class="fa-solid fa-file-invoice"></i> Invoice
              </button>
              ${!c.paid ? `<button class="btn btn-default" onclick="sendReminder('${c.id}')">
                <i class="fa-solid fa-envelope"></i> Reminder
              </button>` : ''}
              ${!c.paid ? `<button class="btn btn-green" onclick="markPaid('${c.id}')">
                <i class="fa-solid fa-check"></i> Mark Paid
              </button>` : ''}
            </td>
          `;
          billingBody.appendChild(row);
        });
      }

      const modal = document.getElementById('invoiceModal');
      const invoiceContent = document.getElementById('invoiceContent');
      const closeModal = document.querySelector('.close');
      closeModal.onclick = () => { modal.style.display = 'none'; };

      function openInvoiceModal(customerId) {
        const customer = billingData.find(c => c.id === customerId);
        if (!customer) return;

        invoiceContent.innerHTML = `
          <p><strong>Customer ID:</strong> ${customer.id}</p>
          <p><strong>Name:</strong> ${customer.name}</p>
          <p><strong>Address:</strong> ${customer.address}</p>
          <p><strong>Month:</strong> ${customer.month}</p>
          <p><strong>Bill Amount:</strong> à§³${customer.amount.toLocaleString()}</p>
          <p><strong>Payment Method:</strong> ${customer.method}</p>
          <p><strong>Status:</strong> ${customer.paid ? 'Paid' : 'Unpaid'}</p>
        `;
        modal.style.display = 'block';
      }

      function printInvoice() {
        const printWindow = window.open('', 'PRINT', 'height=400,width=600');
        printWindow.document.write('<html><head><title>Invoice</title></head><body>');
        printWindow.document.write(invoiceContent.innerHTML);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
      }

      function downloadInvoice() {
        const doc = new jsPDF();
        doc.text(invoiceContent.innerText, 10, 10);
        doc.save('invoice.pdf');
      }

      function markPaid(customerId) {
        const customer = billingData.find(c => c.id === customerId);
        if (customer) {
          customer.paid = true;
          renderBillingTable(billingData);
          alert(`Payment marked as paid for ${customer.name}`);
        }
      }

      function sendReminder(customerId) {
        const customer = billingData.find(c => c.id === customerId);
        if (!customer) return;
        alert(`ðŸ“© Reminder sent to ${customer.name} (${customer.method}) for à§³${customer.amount}`);
        console.log(`Reminder sent to ${customer.name}`);
      }

      document.getElementById('searchInput').addEventListener('input', function() {
        const val = this.value.toLowerCase();
        const filtered = billingData.filter(c => c.name.toLowerCase().includes(val) || c.id.toLowerCase().includes(val));
        renderBillingTable(filtered);
      });
      renderBillingTable(billingData);
      updateAnalytics();

      renderBillingTable(billingData);
    </script>
  </body>
</html>
